"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{6298:(e,t,r)=>{r.d(t,{A5:()=>Q});var a=r(5437),s=r(1379),l=r(4109),n=r(8909),o=r(8691);let i=(0,s.f)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),d=(0,s.f)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),c=(0,s.f)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),m=(0,s.f)("Telescope",[["path",{d:"m10.065 12.493-6.18 1.318a.934.934 0 0 1-1.108-.702l-.537-2.15a1.07 1.07 0 0 1 .691-1.265l13.504-4.44",key:"k4qptu"}],["path",{d:"m13.56 11.747 4.332-.924",key:"19l80z"}],["path",{d:"m16 21-3.105-6.21",key:"7oh9d"}],["path",{d:"M16.485 5.94a2 2 0 0 1 1.455-2.425l1.09-.272a1 1 0 0 1 1.212.727l1.515 6.06a1 1 0 0 1-.727 1.213l-1.09.272a2 2 0 0 1-2.425-1.455z",key:"m7xp4m"}],["path",{d:"m6.158 8.633 1.114 4.456",key:"74o979"}],["path",{d:"m8 21 3.105-6.21",key:"1fvxut"}],["circle",{cx:"12",cy:"13",r:"2",key:"1c1ljs"}]]),u=(0,s.f)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),x=({oracleHistory:e,selectedProjectName:t,uploadNewProjectOption:r,selectedItemId:l,updateUrlWithItemId:n,projectSelector:o,setSelectedItem:i})=>s.j.jsx(s.g,{open:!0,beforeTitle:o,location:"left",rootClassNames:"absolute left-0 h-full shadow-lg lg:shadow-none lg:sticky top-0 bg-gray-50 dark:bg-gray-800 z-20 border-r border-gray-100 dark:border-gray-700",title:s.j.jsxs("h2",{className:"font-bold text-gray-800 dark:text-gray-200 mb-3 text-lg flex items-center",children:[s.j.jsx("span",{className:"mr-2",children:"\uD83D\uDCDA"})," History"]}),contentClassNames:"w-72 p-5 rounded-tl-lg relative sm:block min-h-96 max-h-full overflow-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent",children:s.j.jsxs("div",{className:"space-y-4",children:[t!==r?s.j.jsx("div",{className:(0,s.t)("title hover:cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 history-item p-3 text-sm rounded-md transition-colors duration-200 mb-3 flex items-center border border-transparent",l?"text-gray-700 dark:text-gray-300 hover:border-gray-200 dark:hover:border-gray-700":"font-medium bg-blue-50 dark:bg-gray-700 border-blue-200 dark:border-blue-800 shadow-sm text-blue-700 dark:text-blue-300"),onClick:()=>{n(null),i(null)},children:s.j.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.j.jsx(a.S,{size:18}),s.j.jsx("span",{className:"font-medium",children:"New Report"}),s.j.jsx(s.K,{keyValue:s.h.NEW_QUESTION,meta:!0})]})}):s.j.jsx("p",{className:"text-xs",children:"Upload a new CSV/Excel file on the right"}),t!==r&&e[t]&&Object.entries(e[t]).map(([e,t])=>t&&0!==Object.keys(t).length?s.j.jsxs("div",{className:"mb-6",children:[s.j.jsxs("div",{className:"px-2 mb-3 text-xs font-medium tracking-wide text-blue-600 dark:text-blue-400 uppercase flex items-center",children:[s.j.jsx("div",{className:"h-px bg-blue-100 dark:bg-blue-800 flex-grow mr-2"}),e,s.j.jsx("div",{className:"h-px bg-blue-100 dark:bg-blue-800 flex-grow ml-2"})]}),t.map(e=>{var t,r,a;let o="report"===e.itemType,d=e.itemId,c=o?e.report_name||(null==(t=e.inputs)?void 0:t.user_question)||"Untitled report":e.analysisTree&&(null==(a=null==(r=Object.values(e.analysisTree)[0])?void 0:r.root)?void 0:a.user_question)||"Untitled analysis";return s.j.jsxs("div",{onClick:()=>{n(d),i(e)},className:(0,s.t)("title hover:cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 history-item p-3 text-sm rounded-md transition-colors duration-200 mb-2 border border-transparent",String(d)===String(l)?"font-medium bg-blue-50 dark:bg-gray-700 border-blue-200 dark:border-blue-800 shadow-sm text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300 hover:border-gray-200 dark:hover:border-gray-700"),children:[s.j.jsx("div",{className:"overflow-hidden transition-all duration-300 hover:max-h-[500px]",children:s.j.jsx("p",{className:"font-medium hover:line-clamp-none line-clamp-2",children:c})}),s.j.jsxs("div",{className:"flex items-center text-xs mt-1.5 text-gray-500 dark:text-gray-400",children:[s.j.jsx("span",{className:`inline-block w-3 h-3 mr-1.5 rounded-full ${o?e.status===J.DONE?"bg-blue-200 dark:bg-blue-800":e.status===J.THINKING?"bg-green-300 dark:bg-green-600":e.status===J.ERRORED?"bg-red-200 dark:bg-red-800":"bg-blue-200 dark:bg-blue-800":"bg-yellow-200 dark:bg-yellow-800"}`,title:`Type: ${o?"Report":"Analysis"}`}),new Date(e.date_created+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})]})]},d)})]},e):null)]})}),g=({key:e,ctrl:t=!1,meta:r=!1,shift:a=!1,alt:s=!1,target:n,callback:o=()=>{}},i=[])=>{(0,l.useEffect)(()=>{let l=n??document,i=l=>{let n=window.navigator.platform.includes("Mac");l.key.toLowerCase()===e.toLowerCase()&&(r&&(n?l.metaKey:l.ctrlKey)||!r&&!(n?l.metaKey:l.ctrlKey))&&(t&&l.ctrlKey||!t&&!l.ctrlKey)&&(a&&l.shiftKey||!a&&!l.shiftKey)&&(s&&l.altKey||!s&&!l.altKey)&&(l.stopPropagation(),l.preventDefault(),o(l))};return l.addEventListener("keydown",i),()=>{l.removeEventListener("keydown",i)}},[e,o,...i])},p=({clarification:e,options:t,input_type:r,onAnswerChange:a,onDismiss:n})=>{let o=(0,l.useMemo)(()=>{switch(r){case"single_choice":return s.j.jsx(s.S,{label:e,options:t.map(e=>({label:e,value:e})),onChange:a});case"multiple_choice":return s.j.jsx(s.k,{label:e,options:t.map(e=>({label:e,value:e})),onChange:a});default:return s.j.jsx(s.i,{label:e,onChange:e=>a(e.target.value)})}},[]);return s.j.jsxs("div",{className:"relative antialiased will-change-auto",children:[n&&s.j.jsx("button",{onClick:n,className:"absolute -right-2 -top-2 p-1 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors will-change-auto z-[26]",title:"Dismiss",children:s.j.jsx(s.X,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),s.j.jsx("div",{className:"text-base font-medium will-change-auto",children:o})]})};function h(){let{searchBarManager:e}=(0,l.useContext)(a.O),t=(0,l.useSyncExternalStore)(e.subscribeToDraftChanges,e.getDraft);return s.j.jsx("div",{className:"w-full flex flex-col items-start relative justify-center m-auto antialiased",children:t.clarifications&&s.j.jsx("div",{className:"w-full max-w-4xl",children:s.j.jsx("div",{className:"space-y-4",children:t.clarifications.map((t,r)=>(0,l.createElement)(p,{...t,key:r+t.clarification,onAnswerChange:t=>{e.setDraft(e=>({...e,clarifications:e.clarifications.map((e,a)=>a===r?{...e,answer:t,is_answered:!!t&&("string"==typeof t?!!t:t.length>0)}:e)}))},onDismiss:()=>{e.setDraft(e=>({...e,clarifications:e.clarifications.filter((e,t)=>t!==r)}))}}))})})})}let j=({selectedItem:e})=>{let{searchBarManager:t}=(0,l.useContext)(a.O),[r,n]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n(navigator.userAgent.toLowerCase().includes("mac"))},[]);let o=(0,l.useSyncExternalStore)(t.subscribeToDraftChanges,t.getDraft);return s.j.jsx("div",{className:(0,s.t)("text-lg dark:text-gray-200 font-light mb-0 flex items-center justify-between"),children:s.j.jsx("div",{children:(null==e?void 0:e.itemType)==="query-data"?"Ask a follow on question":a.s[o.status]})})},y={"query-data":s.j.jsx(u,{className:"w-5 stroke-yellow-500"}),report:s.j.jsx(m,{className:"w-5 stroke-fuchsia-300"})},b={default:"absolute bottom-1/2 left-1/2 -translate-x-1/2 translate-y-1/2 w-full px-4","query-data":"absolute bottom-2 left-1/2 -translate-x-1/2 w-full px-4",report:"absolute -bottom-48 left-1/2 -translate-x-1/2 w-full px-4 opacity-0","new-project":"absolute -bottom-48 left-1/2 -translate-x-1/2 w-full px-4 opacity-0"};function f({projectName:e,uploadNewProjectOption:t,onReportGenerated:r,onNewProjectCreated:d,createNewFastAnalysis:c,rootClassNames:m="",selectedItem:u=null,setSelectedItemId:x}){let[p,f]=(0,l.useState)(""),[v,w]=(0,l.useState)(!1),{searchBarManager:k,apiEndpoint:N,token:S}=(0,l.useContext)(a.O),I=(0,l.useContext)(s.a),[C,_]=(0,l.useState)(!1),[E,T]=(0,l.useState)(!1),[P,M]=(0,l.useState)([]),[D,A]=(0,l.useState)([]),[R,q]=(0,l.useState)(!1),[O,L]=(0,l.useState)(!1),[z,U]=(0,l.useState)(!1),F=(0,l.useRef)(null),H=(0,l.useSyncExternalStore)(k.subscribeToDraftChanges,k.getDraft),B=(0,l.useRef)(null),Q=(0,l.useCallback)(async()=>{var t,s;try{if(!H.reportId)throw Error("No report ID");if(!B.current.value&&!H.userQuestion)throw Error("No question!");let l=H.reportId,n=H.userQuestion||(null==(t=B.current)?void 0:t.value);k.setDraft(e=>({...e,status:"submitting"})),T(!0),f("");try{r({userQuestion:n,reportId:l,status:J.THINKING}),x(l),I.success("Report submitted for generation");try{await (0,a.g)(N,S,e,l,n,(null==(s=H.clarifications)?void 0:s.filter(e=>e.answer&&e.is_answered))||[],H.useWebsearch)}catch{console.log("Expected timeout for report generation")}}catch(e){console.error("Error handling report generation:",e)}k.resetDraft(),B.current.value=""}catch(e){f(`Error generating report: ${e}`),I.error(`Error generating report: ${e}`)}finally{T(!1)}},[H,N,S,e,r,I]);(0,l.useEffect)(()=>{_(navigator.userAgent.toLowerCase().includes("mac"))},[]),(0,l.useEffect)(()=>{(async()=>{if(!e||e===t||!S){M([]),A([]);return}try{q(!0);let t=await (0,a.f)(N,S,e);M(t.tables),A(t.pdf_files)}catch(e){console.error("Error fetching tables and files:",e)}finally{q(!1)}})()},[e,N,S,t]);let[W,V]=(0,l.useState)(!1);(0,l.useEffect)(()=>{var e,t;H.userQuestion!==(null==(e=B.current)?void 0:e.value)&&(B.current.value=H.userQuestion,null==(t=B.current)||t.focus())},[H]),g({key:s.h.FOCUS_ORACLE_SEARCH,callback:r=>{var a;e===t||(null==u?void 0:u.itemType)==="report"||null==(a=B.current)||a.focus()}},[B]),g({key:s.h.NEW_QUESTION,meta:!0,callback:()=>{u&&window.dispatchEvent(new CustomEvent("oracle:new-report")),k.resetDraft(),B.current&&(B.current.value="",B.current.focus())}},[k,u,B]),g({key:s.h.TOGGLE_MODE,meta:!0,callback:()=>{if(!u){let e="query-data"===H.mode?"report":"query-data";B.current&&(B.current.style.transition="height 0.3s ease-in-out, opacity 0.3s ease-in-out"),k.setMode(e)}}},[H.mode,k,u,B]);let K=(0,l.useMemo)(()=>null,[]),$=(0,l.useMemo)(()=>0===P.length&&0===D.length||(null==u?void 0:u.itemType)==="query-data"||(null==u?void 0:u.itemType)==="report"?null:s.j.jsx("div",{className:"mb-3",children:s.j.jsx("div",{className:"p-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm max-h-96 overflow-y-auto custom-scrollbar",children:s.j.jsxs("div",{className:"flex flex-col gap-2",children:[P.length>0&&s.j.jsxs("div",{children:[s.j.jsxs("div",{className:"font-medium mb-1 flex items-center",children:[s.j.jsx(i,{className:"w-4 h-4 mr-2 text-blue-500 dark:text-blue-400"}),s.j.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Available Tables"})]}),s.j.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto pr-1 custom-scrollbar",children:P.map(e=>s.j.jsx("div",{className:"bg-white dark:bg-gray-700 px-2 py-1 rounded border border-gray-200 dark:border-gray-600 text-xs text-gray-900 dark:text-gray-200 flex items-center",children:e},e))})]}),D.length>0&&s.j.jsxs("div",{children:[s.j.jsxs("div",{className:"font-medium mb-1 flex items-center",children:[s.j.jsx(s.F,{className:"w-4 h-4 mr-2 text-blue-500 dark:text-blue-400"}),s.j.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Available PDF Files"})]}),s.j.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto pr-1 custom-scrollbar",children:D.map(e=>s.j.jsx("div",{className:"bg-white dark:bg-gray-700 px-2 py-1 rounded border border-gray-200 dark:border-gray-600 text-xs text-gray-900 dark:text-gray-200 flex items-center",title:e.file_id,children:e.file_name},e.file_id))})]}),R&&s.j.jsxs("div",{className:"flex items-center justify-center p-1",children:[s.j.jsx(s.d,{classNames:"w-4 h-4 mr-2"}),s.j.jsx("span",{className:"text-xs text-gray-500",children:"Loading resources..."})]})]})})}),[P,D,R,u]);return s.j.jsxs("div",{className:(0,s.t)("oracle-search transition-all duration-700 ease-in-out z-[30] *:transition-all *:duration-700 *:ease-in-out",b[(null==u?void 0:u.itemType)||(e===t?"new-project":"default")]),children:[p&&s.j.jsx("div",{className:"mb-4 absolute -top-16",children:s.j.jsx(o.A,{type:"error",message:p,dismissable:!0,onDismiss:()=>f("")})}),$,s.j.jsxs(o.D,{rootClassNames:(0,s.t)("drop-drop min-h-0 relative z-[2] rounded-2xl p-2 border bg-white dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 overflow-visible",(null==u?void 0:u.itemType)==="query-data"?"shadow-custom border-gray-300 dark:border-gray-600":"",m),acceptedFileTypes:[".csv",".pdf",".xlsx",".xls"],fileSelection:!1,allowMultiple:!0,onDragOver:e=>{e.preventDefault(),e.stopPropagation(),w(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),w(!1)},onInvalidFiles:(e,t,r)=>{I.error(r)},onDrop:async(t,r)=>{try{if(t.preventDefault(),t.stopPropagation(),(null==u?void 0:u.itemType)==="query-data")return;if(w(!1),!t.dataTransfer){console.error("No dataTransfer in drop event");return}if(0===r.length)throw console.error("No valid files found"),Error("Only CSV, Excel or PDF files are accepted.");T(!0),I.info("Uploading files...");try{let t=await (0,n.c)(N,S,r,e);if(t.projectName!==e){console.log("New project created from file upload:",t.projectName),I.success("New project created from file upload: "+t.projectName),F.current=t.projectName,d(F.current);let e=await (0,a.f)(N,S,F.current);M(e.tables),A(e.pdf_files)}else{let t=await (0,a.f)(N,S,e);M(t.tables),A(t.pdf_files)}}catch(e){throw console.error("Error uploading files:",e),Error(`Failed to upload files: ${e.message}`)}finally{T(!1)}}catch(e){console.error("Error processing files:",e),I.error(e.message),T(!1)}},children:[s.j.jsx(j,{selectedItem:u}),s.j.jsx(s.i,{onChange:e=>{k.setQuestion(e.target.value)},prefix:K,ref:B,rootClassNames:(0,s.t)("w-full py-2 transition-all duration-300 ease-in-out","report"===H.mode?"min-h-[8rem]":"min-h-[5rem]"),textAreaClassNames:"border-0 outline-0 ring-0 focus:ring-0 bg-gray-50 w-full max-h-60",suffix:s.j.jsxs("div",{className:(0,s.t)("flex flex-col"),children:[s.j.jsxs("div",{className:(0,s.t)("dark:text-gray-400"),children:[s.j.jsxs("div",{className:"flex items-center justify-between",children:[s.j.jsxs("div",{children:["Press"," ",C?s.j.jsxs(s.j.Fragment,{children:[s.j.jsx(s.C,{className:"inline align-middle w-2.5"}),"+ Enter"]}):"Ctrl + Enter",null!=u&&u.itemType?" to submit. ":" to start. Drop CSV or Excel files to analyse them. Drop PDFs to add context to the report. "]}),s.j.jsxs("div",{className:"relative",children:[s.j.jsx("button",{onClick:async()=>{var t,r;if(!(null!=(t=B.current)&&t.value)){f("Please enter a question");return}try{if(V(!0),T(!0),k.setDraft(e=>({...e,userQuestion:B.current.value,status:"getting_clarifications"})),f(""),(null==(r=H.uploadedFiles)?void 0:r.length)>0)try{await (0,n.c)(N,S,H.uploadedFiles,e);let t=await (0,a.f)(N,S,e);M(t.tables),A(t.pdf_files)}catch(e){throw Error(`Failed to upload files: ${e.message}`)}let t=F.current||e;if("query-data"===H.mode||(null==u?void 0:u.itemType)==="query-data")k.resetDraft(),c(B.current.value,t),B.current&&(B.current.value="");else{let e=await (0,a.h)(N,S,t,B.current.value);k.setDraft(t=>({...t,loading:!1,userQuestion:B.current.value,status:"clarifications_received",clarifications:e.clarifications,reportId:e.report_id,uploadedFiles:[]}))}}catch(e){console.log(e),f(e.toString()),k.resetDraft()}finally{T(!1),V(!1),F.current=null}},disabled:E,className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit"}),O&&s.j.jsxs("div",{className:"absolute -top-10 right-0 z-40 px-3 py-2 text-sm font-medium bg-white text-gray-800 dark:bg-gray-800 dark:text-gray-200 rounded-md border border-gray-300 dark:border-gray-700 shadow-md whitespace-nowrap",children:["Press ",C?"âŒ˜+Enter":"Ctrl+Enter"," to submit",s.j.jsx("div",{className:"absolute w-3 h-3 bg-white dark:bg-gray-800 border-r border-b border-gray-300 dark:border-gray-700 transform rotate-45 -bottom-1.5 right-4"})]})]})]}),s.j.jsxs("div",{className:"flex gap-2 mt-1 text-xs text-gray-500 dark:text-gray-400",children:[s.j.jsx("span",{className:"flex items-center",children:s.j.jsx(s.K,{keyValue:s.h.FOCUS_ORACLE_SEARCH,className:"mr-1",text:"Focus search"})}),u&&s.j.jsx("span",{className:"flex items-center",children:s.j.jsx(s.K,{keyValue:s.h.NEW_QUESTION,className:"mr-1",meta:!0,text:"New question"})}),!(null!=u&&u.itemType)&&s.j.jsx("span",{className:"flex items-center",children:s.j.jsx(s.K,{keyValue:s.h.TOGGLE_MODE,className:"mr-1",meta:!0,text:"Toggle mode"})})]})]}),s.j.jsxs("div",{className:(0,s.t)("flex flex-row mt-8 gap-4 items-center",(null==u?void 0:u.itemType)==="query-data"&&"h-0 mt-0 overflow-hidden opacity-0"),children:[s.j.jsx("div",{className:"flex items-center gap-3",children:s.j.jsx(o.T,{disabled:(null==u?void 0:u.itemType)==="query-data"||W||!!(H.clarifications&&H.clarifications.length),onToggle:e=>{B.current&&(B.current.style.transition="height 0.3s ease-in-out, opacity 0.3s ease-in-out"),k.setMode(e?"report":"query-data"),V(!1)},checked:"report"===H.mode,showBothLabels:!0,onLabel:s.j.jsxs("span",{className:"flex items-center gap-1 transition-all duration-300 ease-in-out",children:[y.report,s.j.jsx("span",{className:"whitespace-nowrap",children:"Deep Research"})]}),offLabel:s.j.jsxs("span",{className:"flex items-center gap-1 transition-all duration-300 ease-in-out",children:[y["query-data"],s.j.jsx("span",{className:"whitespace-nowrap",children:"Fast Analysis"})]})})}),"report"===H.mode&&(null==u?void 0:u.itemType)!=="query-data"?s.j.jsx(o.T,{onLabel:"Use web search to enhance report",offLabel:"Use web search to enhance report",defaultOn:H.useWebsearch,disabled:W||!!(H.clarifications&&H.clarifications.length),onToggle:e=>{k.setDraft(t=>({...t,useWebsearch:e}))}}):null]})]}),disabled:E,placeholder:(null==u?void 0:u.itemType)==="query-data"?"Type here":v?"Release to drop":"report"===H.mode?`I will start a Deep Research process on your data tables, any PDF files you have uploaded, and the web. For best results:
- include the kind of analysis you want done
- your desired areas of focus
- any concrete sources you want me to look at`:"Type your question here or drop PDF, CSV or Excel files",autoResize:!0,defaultRows:1,textAreaHtmlProps:{style:{resize:"none"}},onKeyDown:async t=>{var r;if("/"===t.key&&t.stopPropagation(),"Enter"!==t.key||t.metaKey||t.ctrlKey||t.shiftKey||z||(t.stopPropagation(),L(!0),U(!0),setTimeout(()=>{L(!1)},3e3)),"Enter"===t.key&&(t.metaKey||t.ctrlKey)){let s=t.currentTarget.value;if(!s){f("Please enter a question");return}try{if(V(!0),T(!0),k.setDraft(e=>({...e,userQuestion:s,status:"getting_clarifications"})),f(""),(null==(r=H.uploadedFiles)?void 0:r.length)>0){console.log("Uploading remaining files before submitting question");try{await (0,n.c)(N,S,H.uploadedFiles,e);let t=await (0,a.f)(N,S,e);M(t.tables),A(t.pdf_files)}catch(e){throw console.error("Error uploading files:",e),Error(`Failed to upload files: ${e.message}`)}}let t=F.current||e;if("query-data"===H.mode||(null==u?void 0:u.itemType)==="query-data")console.log("Starting fast analysis with project name:",t),k.resetDraft(),c(s,t),B.current&&(B.current.value="");else{console.log("Getting clarifications with project name:",t);let e=await (0,a.h)(N,S,t,s);k.setDraft(t=>({...t,loading:!1,userQuestion:s,status:"clarifications_received",clarifications:e.clarifications,reportId:e.report_id,uploadedFiles:[]}))}}catch(e){console.log(e),f(e.toString()),k.resetDraft()}finally{T(!1),V(!1),F.current=null}}}})]}),!E&&H.clarifications&&H.clarifications.length>0&&!u&&"query-data"!==H.mode&&s.j.jsxs("div",{className:"w-11/12 mx-auto my-0 flex flex-col z-[20] relative",children:[s.j.jsx("div",{className:"border border-blue-500 dark:border-sky-600 rounded-t-xl bg-sky-200 dark:bg-sky-900 border-b-0 mt-4",children:s.j.jsx("div",{className:"h-96 overflow-y-auto py-2 px-4",children:s.j.jsx(h,{})})}),s.j.jsx("div",{className:"border border-blue-500 dark:border-sky-600 rounded-b-xl bg-sky-200 dark:bg-sky-900 py-3 px-4 border-t-0",children:s.j.jsx("button",{className:"bg-gray-600 text-white border-0 hover:bg-gray-700 dark:bg-gray-600 dark:hover:bg-gray-600 text-base py-2 px-4 rounded",onClick:Q,children:"Generate"})})]}),E&&s.j.jsx("div",{className:"w-11/12 mx-auto border border-blue-500 dark:border-sky-600 rounded-xl bg-sky-200 dark:bg-sky-900 overflow-hidden mt-4",children:s.j.jsx("div",{className:"flex flex-col gap-2 py-2 px-4",children:s.j.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300 flex items-center",children:[s.j.jsx(s.d,{classNames:"w-4 mr-1"}),a.s[H.status]]})})})]})}let v=({selectedProjectName:e,projectNames:t,uploadNewProjectOption:r,hasUploadedFiles:a,onProjectChange:l})=>s.j.jsx("div",{children:s.j.jsx(s.S,{disabled:a,label:"Select project",rootClassNames:"mb-2",value:e,allowClear:!1,allowCreateNewOption:!1,options:[{value:r,label:"Upload new"}].concat(t.map(e=>({value:e,label:e}))),onChange:e=>l(e)})});async function w({question:e,projectName:t,analysisId:r,selectedItem:a,createNewFastAnalysis:s,setOracleHistory:l,updateUrlWithItemId:n,setSelectedItemId:o,setSelectedProjectName:i,messageManager:d}){try{let{rootAnalysisId:c,analysisTree:m,treeManager:u}=await s({question:e,projectName:t,analysisId:r,rootAnalysisId:r,treeManager:(null==a?void 0:a.itemType)==="query-data"?a.treeManager:void 0}),x={date_created:er(),itemId:c,analysisTree:m,treeManager:u,itemType:"query-data"};return l(e=>{var r,a,s,l,n;let o={...e};return{...e,[t]:{...e[t],Today:[x,...(null==(r=null==e?void 0:e[t])?void 0:r.Today)||[]],Yesterday:(null==(a=null==e?void 0:e[t])?void 0:a.Yesterday)||[],"Past week":(null==(s=null==e?void 0:e[t])?void 0:s["Past week"])||[],"Past month":(null==(l=null==e?void 0:e[t])?void 0:l["Past month"])||[],Earlier:(null==(n=null==e?void 0:e[t])?void 0:n.Earlier)||[]}}}),n(c),o(c),i(t),d.success("New analysis created"),{rootAnalysisId:c,analysisTree:m,treeManager:u}}catch(e){throw console.error("Error in OracleCreateNewAnalysis:",e),d.error("Failed to create analysis: "+e.message),e}}function k({step:e}){var t;let{function_name:r,result:l}=e;l||(l={});let{question:n,sql:o,columns:i=[],rows:d="[]",error:c="",df_truncated:m=!1}=l,u=c||(i&&i.length?"":"No results"),x=[];if(d&&!c)try{x=JSON.parse(d)}catch(e){console.error("Failed to parse rows JSON:",e),u="Failed to parse rows JSON"}let g=x.length;return s.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-full overflow-y-auto",children:[s.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary flex items-center",children:[s.j.jsx("span",{className:"mr-2",children:"SQL Query"}),!u&&s.j.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900/30 dark:text-blue-300",children:["Resulting data has ",g," ",1===g?"row":"rows"]})]}),n&&s.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[s.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),s.j.jsx("p",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic text-gray-700 dark:text-dark-text-secondary",children:n})]}),(null==(t=e.inputs)?void 0:t.db_name)&&s.j.jsx("div",{className:"mb-3",children:s.j.jsxs("span",{className:"inline-flex items-center gap-1 bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300 text-xs font-medium px-2.5 py-1 rounded",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[s.j.jsx("path",{d:"M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"}),s.j.jsx("path",{d:"M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"}),s.j.jsx("path",{d:"M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"})]}),e.inputs.db_name]})}),u?s.j.jsxs("div",{className:"text-red-600 bg-red-100 p-3 rounded-md dark:bg-red-900/20 dark:text-red-400 dark:border dark:border-red-800",children:[s.j.jsxs("div",{className:"flex items-center mb-1",children:[s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1.5",viewBox:"0 0 20 20",fill:"currentColor",children:s.j.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.j.jsx("strong",{children:"Query Error"})]}),s.j.jsx("p",{children:u})]}):s.j.jsx("div",{className:"mt-3 border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:s.j.jsx(s.c,{tabs:[{name:"Results",content:s.j.jsxs("div",{className:"relative p-3",children:[m&&s.j.jsxs("div",{className:"text-sm bg-yellow-50 p-2 rounded mb-3 border border-yellow-200 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800 flex items-center",children:[s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5",viewBox:"0 0 20 20",fill:"currentColor",children:s.j.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Results have been truncated"]}),s.j.jsx(s.T,{columns:i.map(e=>({dataIndex:e,title:e})),rows:x,rootClassNames:"shadow-sm"})]})},{name:"SQL",content:s.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 p-3",children:s.j.jsx(a.i,{code:o||"",language:"sql",editable:!1})})}],defaultSelected:"Results"})})]})}function N({step:e}){let{function_name:t,result:r,inputs:l}=e,n=(0,a.j)(a.m.parse(r.answer),{allowedTags:a.j.defaults.allowedTags.concat(["img"]),allowedAttributes:{...a.j.defaults.allowedAttributes,img:["src","alt","title"]}});return s.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-[600px] overflow-y-auto",children:[s.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary",children:["Function: ",s.j.jsx("span",{className:"font-normal",children:t})]}),(null==l?void 0:l.question)&&s.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[s.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),s.j.jsx("p",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic text-gray-700 dark:text-dark-text-secondary",children:l.question})]}),s.j.jsx("div",{className:"text-gray-700 dark:text-dark-text-secondary prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:n}}),r.reference_sources&&s.j.jsxs("div",{children:[s.j.jsx("h3",{children:"Reference Sources"}),s.j.jsx("ul",{children:r.reference_sources.map((e,t)=>s.j.jsx("li",{children:s.j.jsx("a",{href:e.url,target:"_blank",children:e.source})},t))})]})]})}function S({step:e}){let{function_name:t,result:r,inputs:l}=e,n=r.citations.map(e=>e.text).join(""),o=(0,a.j)(a.m.parse(n),{allowedTags:a.j.defaults.allowedTags.concat(["img"]),allowedAttributes:{...a.j.defaults.allowedAttributes,img:["src","alt","title"]}});return s.j.jsxs("div",{className:"border p-4 rounded-md shadow-sm bg-white dark:bg-dark-bg-secondary dark:border-dark-border max-h-[600px] overflow-y-auto",children:[s.j.jsxs("h2",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-dark-text-primary",children:["Function: ",s.j.jsx("span",{className:"font-normal",children:t})]}),(null==l?void 0:l.question)&&s.j.jsxs("div",{className:"mb-3 text-gray-700 dark:text-dark-text-secondary",children:[s.j.jsx("p",{className:"mb-1 font-medium text-gray-800 dark:text-dark-text-primary",children:"Question"}),s.j.jsx("p",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-md border-l-2 border-blue-500 dark:border-blue-600 italic text-gray-700 dark:text-dark-text-secondary",children:l.question})]}),s.j.jsx("div",{className:"text-gray-700 dark:text-dark-text-secondary prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:o}})]})}let I=`

------

`;function C({apiEndpoint:e,token:t,reportId:r,onStreamClosed:a=()=>{},onDelete:n=()=>{}}){let[o,i]=(0,l.useState)([]),[d,c]=(0,l.useState)(!1),m=(0,l.useRef)(o);m.current=o;let u=(0,l.useContext)(s.a);return(0,l.useEffect)(()=>{let s=!1,l=new AbortController,n=(e,t=!1)=>{l.abort(),null==e||e.releaseLock(),c(!0),a(m.current,t)};return async function(){var a;try{let s=await fetch(`${e}/oracle/get_report_thinking_status?report_id=${r}`,{headers:{"X-Auth-Token":t},signal:l.signal});if(!s.ok){console.error("Stream request failed:",s.status),c(!0);return}let o=null==(a=s.body)?void 0:a.getReader();if(!o){console.error("No reader found on response body."),c(!0);return}let d=new TextDecoder("utf-8"),m="";for(;;){let{done:e,value:t}=await o.read();if(e){console.log("Stream ended from server.");break}let r=[];for(let e of(m+=d.decode(t,{stream:!0})).split(I)){let t=e.replace("data:","").trim();if(t){if("Stream closed without errors"===t){console.log("[Stream Event] 'Stream closed' received."),n(o);return}if("Stream closed with errors"===t){n(o,!0);return}try{let e=JSON.parse(t);if(e.error){u.error("Could not generate report. Error: "+e.error),n(o,!0);return}Array.isArray(e)?r.push(...e):r.push(e)}catch(e){console.warn("Failed to parse SSE data:",e)}}}i(r)}c(!0)}catch(e){s||console.error("[Stream Error]",e),c(!0)}}(),()=>{s=!0,l.abort()}},[e,t,r]),s.j.jsxs("div",{className:"relative p-2 overflow-auto",children:[s.j.jsxs("div",{className:"flex flex-row w-full items-center mb-4 mt-4",children:[s.j.jsx("h1",{className:"text-xl font-bold grow dark:text-dark-text-primary",children:"Details"}),s.j.jsx(s.B,{variant:"danger",className:"self-end",onClick:n,children:"Delete"})]}),!d&&s.j.jsxs("div",{className:"w-full h-40 bg-white dark:bg-gray-800 rounded-md border flex items-center justify-center gap-2",children:[s.j.jsx(s.d,{classNames:"w-5 h-5 text-blue-500 animate-spin"}),s.j.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Creating SQL queries and searching the web to answer your question. I will show my thinking below. The report will automatically load when I am done thinking."})]}),s.j.jsx("div",{className:"w-full",children:o.filter(e=>{var t;return!("object"==typeof e.result&&null!=(t=e.result)&&t.error)}).reverse().map(e=>s.j.jsx("div",{className:"w-full md:w-1/2 p-2 inline-block align-top transition-all duration-500 ease-in-out",children:"text_to_sql_tool"===e.function_name?s.j.jsx(k,{step:e}):"web_search_tool"===e.function_name?s.j.jsx(N,{step:e}):"pdf_citations_tool"===e.function_name?s.j.jsx(S,{step:e}):null},e.id))})]})}let _=({selectedItem:e,selectedProjectName:t,token:r,apiEndpoint:n})=>{let o=(0,l.useRef)({}),[i,d]=(0,l.useState)(!1),c=(0,l.useMemo)(()=>e.treeManager||(0,a.A)(e.analysisTree),[e]),m=(0,l.useSyncExternalStore)(c.subscribeToDataChanges,c.getTree),u=(0,l.useMemo)(()=>c.getNestedTree(),[m]),x=(0,l.useMemo)(()=>Object.keys(u)[0]||null,[u]),{searchBarManager:g}=(0,l.useContext)(a.O);(0,l.useEffect)(()=>{x&&(c.setActiveRootAnalysisId(x),c.setActiveAnalysisId(x))},[c,x]);let p=(0,l.useCallback)(e=>{e&&g.setQuestion(e)},[g]);return x?s.j.jsx(a.Q.Provider,{value:{token:r,apiEndpoint:n,hiddenCharts:[],hideSqlTab:!1,hidePreviewTabs:!1,hideRawAnalysis:!0,analysisDataCache:{},updateConfig:()=>{}},children:s.j.jsx(a.k,{projectName:t,activeRootAnalysisId:x,nestedTree:u,metadata:null,analysisDomRefs:o,analysisTreeManager:c,autoScroll:!0,setLoading:d,submitFollowOn:p})}):null},E=({apiEndpoint:e,token:t,selectedItemId:r,selectedItem:l,selectedProjectName:n,uploadNewProjectOption:o,searchBar:i,onReportDelete:d,onReportParsed:c,onThinkingStreamClosed:m,setMostVisibleAnalysisAsActive:u,onProjectCreated:x})=>s.j.jsxs("div",{className:"flex flex-col grow p-2 relative min-w-0 overflow-hidden",children:[null===r&&n===o&&s.j.jsx(a.C,{apiEndpoint:e,token:t,onProjectCreated:x}),r&&l&&"analysisTree"in l?s.j.jsx("div",{className:"p-4 space-y-4 max-h-full overflow-y-auto pb-48",onScroll:(0,a.l)(e=>{e.stopPropagation(),u()},100),children:s.j.jsx(a.E,{children:Object.keys(l.analysisTree).length>0&&s.j.jsx(_,{selectedItem:l,selectedProjectName:n,token:t,apiEndpoint:e})})}):r&&l&&"status"in l&&l.status===J.DONE?s.j.jsx(Y,{reportId:r,apiEndpoint:e,projectName:n,token:t,onDelete:d,onReportParsed:c},r):r?s.j.jsx(C,{apiEndpoint:e,token:t,reportId:r,onDelete:d,onStreamClosed:m}):null,i]}),T=({error:e})=>s.j.jsxs("div",{className:"w-screen h-screen flex items-center justify-center bg-rose-50 text-rose-500",children:["Error: ",e]}),P=({message:e="Loading"})=>(console.log("Rendering OracleLoading with message:",e),s.j.jsx("div",{className:"w-screen h-screen flex flex-col gap-4 items-center justify-center bg-gray-50 text-gray-400",children:s.j.jsxs("div",{className:"flex items-center",children:[s.j.jsx(s.d,{})," ",s.j.jsx("span",{className:"ml-2",children:e})]})})),M=()=>{let e=(0,l.useCallback)(()=>{if("u">typeof window){let e=new URLSearchParams(window.location.search).get("item_id");if(e){let t=Number(e);return isNaN(t)?e:t.toString()}}return null},[])();return{urlItemIdRef:(0,l.useRef)(e),updateUrlWithItemId:(0,l.useCallback)(e=>{if("u">typeof window){let t=new URL(window.location.href);if(null!==e){let r=String(e);t.searchParams.set("item_id",r)}else t.searchParams.delete("item_id");window.history.pushState({},"",t.toString())}},[])}},D=(e,t,r)=>{if(!e||!t||!r||!r[e])return"Today";for(let a of Object.keys(r[e]))if(r[e][a]&&Array.isArray(r[e][a])&&r[e][a].some(e=>String(null==e?void 0:e.itemId)===String(t)))return a;return"Today"},A=()=>({Today:[],Yesterday:[],"Past week":[],"Past month":[],Earlier:[]}),R=e=>{let t=new Date,r=new Date(t);r.setDate(r.getDate()-1);let a=new Date(t);a.setDate(a.getDate()-7);let s=new Date(t);return s.setMonth(s.getMonth()-1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===r.toDateString()?"Yesterday":e>=a?"Past week":e>=s?"Past month":"Earlier"},q=e=>{Object.entries(e).forEach(([e,t])=>{t&&Array.isArray(t)&&t.sort((e,t)=>{let r="report_id"in e?new Date(e.date_created+"Z").getTime():new Date(e.date_created).getTime();return("report_id"in t?new Date(t.date_created+"Z").getTime():new Date(t.date_created).getTime())-r})})},O=(e,t,r=null)=>{let[a,s]=(0,l.useState)(e),[n,o]=(0,l.useState)(null),[i,d]=(0,l.useState)({}),[c,m]=(0,l.useState)(r),u=(0,l.useCallback)(e=>{o(e),t(null),m(null)},[t]),x=(0,l.useCallback)(e=>{s(t=>[...t,e]),m(null),d(t=>({...t,[e]:A()}))},[]);return{projectNames:a,setProjectNames:s,selectedProjectName:n,setSelectedProjectName:o,oracleHistory:i,setOracleHistory:d,selectedItemId:c,setSelectedItemId:m,handleProjectChange:u,handleNewProjectCreated:x}},L=(e,t,r,a,s,n,o,i,d,c)=>{let m=null===s||null!==n.current;console.log("Initial loading state:",m,"Selected project:",s,"URL item:",n.current);let[u,x]=(0,l.useState)(m),[g,p]=(0,l.useState)(null),h=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{let l=!1;(async function(){if(h.current||l){console.log("Skipping initial setup - already complete or running");return}console.log("Starting initial setup"),l=!0,x(!0);try{let l=n.current,o={},m=!1,u=null;for(let t of e)o[t]=A();if(l){if(console.log("URL contains item_id:",l,"- searching for it"),s&&s!==a)try{(await z(s,t,r,o,l)).foundUrlItemId&&(m=!0,u=s,console.log("Found item in initial project:",s))}catch(e){console.error("Error searching in project:",s,e)}if(!m)for(let n of e.filter(e=>e!==a&&e!==s))try{if(console.log("Checking project:",n),(await z(n,t,r,o,l)).foundUrlItemId){m=!0,u=n,console.log("Found item in project:",n);break}}catch(e){console.error("Error searching in project:",n,e)}}i(o),m&&u?(console.log("Setting project to",u,"and item to",l),d(u),c(l)):s?console.log("Keeping existing project selection:",s):e.length>0?(console.log("No URL item found, selecting first project"),d(e[0])):(console.log("No projects available, using upload option"),d(a)),console.log("Initial setup completed successfully"),h.current=!0}catch(e){console.error("Initial setup error:",e),p(e.message)}finally{console.log("Setting loading to false in initialSetup"),x(!1),l=!1}})();let o=setTimeout(()=>{u&&(console.log("Safety timeout reached - forcing loading to false"),x(!1),h.current=!0,p("Loading timed out - please try refreshing the page"))},5e3);return()=>clearTimeout(o)},[e,t,r,n,a,s,d,c,i,u,x,p]),(0,l.useEffect)(()=>{if(!h.current||null===s){console.log("Skipping data loading - initial setup not complete or no project selected");return}if(s===a){console.log("Skipping data loading for upload option"),x(!1);return}console.log("Loading data for project:",s);let e=!1;(async function(){if(e){console.log("Already loading data, skipping");return}e=!0,console.log("Setting loading to true for project data"),x(!0);try{let e={...o};e[s]=A();try{await z(s,t,r,e,null)}catch{p("Failed to fetch reports for project name "+s)}i(e)}catch(e){console.error("Data loading error:",e),p(e.message)}finally{console.log("Setting loading to false after project data load"),x(!1),e=!1}})()},[s,t,r,a,i,p]),{loading:u,error:g}};async function z(e,t,r,s,l){let o={foundUrlItemId:!1,foundUrlItemIdProjectName:null},[i,d]=await Promise.all([(0,a.n)(t,r,e),(0,n.f)(t,r,e)]);if(d&&d.length>0&&function(e,t,r,s){let l={foundUrlItemId:!1,foundUrlItemIdProjectName:null};for(let n of e.filter(e=>e.is_root_analysis)){let o=e.filter(e=>e.root_analysis_id===n.analysis_id||e.analysis_id===n.analysis_id),i=(0,a.o)(o),d=(0,a.A)(i);s&&!l.foundUrlItemId&&String(n.analysis_id)===String(s)&&(l.foundUrlItemId=!0,l.foundUrlItemIdProjectName=r);let c={itemType:"query-data",date_created:n.timestamp,itemId:n.analysis_id,analysisTree:i,treeManager:d},m=R(new Date(n.timestamp));t[r][m].push(c)}return l}(d,s,e,l).foundUrlItemId&&(o.foundUrlItemId=!0,o.foundUrlItemIdProjectName=e),!i)throw Error("Failed to get reports");return o.foundUrlItemId||function(e,t,r,a){let s={foundUrlItemId:!1,foundUrlItemIdProjectName:null};return a&&e.find(e=>String(e.report_id)===String(a))&&(s.foundUrlItemId=!0,s.foundUrlItemIdProjectName=r),e.filter(e=>e.status!==J.ERRORED&&e.status!==J.INITIALIZED).forEach(e=>{let a=R(new Date(e.date_created+"Z")),s={...e,itemId:e.report_id,itemType:"report"};t[r][a].push(s)}),s}(i,s,e,l).foundUrlItemId&&(o.foundUrlItemId=!0,o.foundUrlItemIdProjectName=e),q(s[e]),o}let U=e=>({createNewFastAnalysis:(0,l.useCallback)(async function({question:t,projectName:r,analysisId:a,rootAnalysisId:s,treeManager:l=null}){try{return l?F({question:t,projectName:r,analysisId:a,rootAnalysisId:s,treeManager:l}):H({question:t,projectName:r,analysisId:a})}catch(t){throw console.error("Error creating new analysis:",t),e.error("Failed to create analysis: "+t.message),t}},[e])});async function F({question:e,projectName:t,analysisId:r,rootAnalysisId:s,treeManager:l}){let{newAnalysis:o}=await l.submit({question:e,projectName:t,analysisId:r,rootAnalysisId:s,isRoot:!1,directParentId:l.getActiveAnalysisId(),activeTab:"table"});return(0,n.r)(()=>{(0,a.p)(o.analysisId)}),{rootAnalysisId:s,analysisTree:(null==l?void 0:l.getTree())||{},treeManager:l}}async function H({question:e,projectName:t,analysisId:r}){let s=(0,a.A)();return await s.submit({question:e,projectName:t,analysisId:r,rootAnalysisId:r,isRoot:!0,directParentId:null,sqlOnly:!1,isTemp:!1,activeTab:"table"}),{rootAnalysisId:r,analysisTree:s.getTree(),treeManager:s}}let B=(e,t,r,s,n,o,i,d)=>{let c=(0,l.useCallback)(async()=>{let l=D(s,r,o);if(await (0,a.q)(e,r,t,s))return d.success("Report deleted"),i(e=>{let t=e[s][l].filter(e=>"report_id"in e?e.report_id!==r:e.itemId!==r),a={...e,[s]:{...e[s],[l]:t}};return 0===t.length&&delete a[s][l],a}),n(null),null;d.error("Failed to delete report")},[e,t,r,s,n,o,d,i]),m=(0,l.useCallback)(({userQuestion:e,reportId:t,status:r})=>(i(a=>{var l,n,o,i,d;let c={...a};return c[s]={...a[s],Today:[{report_id:t,report_name:e,status:r,date_created:er(),itemId:t,itemType:"report"},...(null==(l=null==a?void 0:a[s])?void 0:l.Today)||[]],Yesterday:(null==(n=null==a?void 0:a[s])?void 0:n.Yesterday)||[],"Past week":(null==(o=null==a?void 0:a[s])?void 0:o["Past week"])||[],"Past month":(null==(i=null==a?void 0:a[s])?void 0:i["Past month"])||[],Earlier:(null==(d=null==a?void 0:a[s])?void 0:d.Earlier)||[]},c}),n(t),t),[s,n,i]);return{onReportDelete:c,handleReportGenerated:m,handleReportParsed:(0,l.useCallback)(e=>{let t=D(s,r,o);i(a=>{let l=a[s][t];return{...a,[s]:{...a[s],[t]:l.map(t=>"report_id"in t&&t.report_id===r?{...t,reportData:e}:t)}}})},[s,r,o,i]),handleThinkingStreamClosed:(0,l.useCallback)((e,t)=>{if(!s||!r||!o[s]){console.warn("Stream closed but project or report data missing");return}let a=D(s,r,o);if(!o[s][a]){console.warn("Stream closed but report group missing:",a);return}t?function(e,t,r,a,s){return s(a=>{let s={...a};return s[e]&&s[e][r]&&Array.isArray(s[e][r])&&(s[e][r]=s[e][r].filter(e=>"report_id"in e?e.report_id!==t:e.itemId!==t)),s}),a(null),null}(s,r,a,n,i):function(e,t,r,a){a(a=>{let s={...a};return s[e]&&s[e][r]&&Array.isArray(s[e][r])&&(s[e][r]=s[e][r].map(e=>e.itemId===t?{...e,status:J.DONE}:e)),s})}(s,r,a,i)},[s,r,o,n,i])}};function Q({apiEndpoint:e,token:t,initialProjectNames:r=[]}){let{current:o}=(0,l.useRef)((0,n.g)()),i=(0,l.useRef)((0,a.r)()),d=(0,l.useRef)((0,s.M)()),{urlItemIdRef:c,updateUrlWithItemId:m}=M(),{projectNames:u,selectedProjectName:g,setSelectedProjectName:p,oracleHistory:h,setOracleHistory:j,selectedItemId:y,setSelectedItemId:b,handleProjectChange:k,handleNewProjectCreated:N}=O(r,m,c.current),{loading:S,error:I}=L(u,e,t,o,g,c,h,j,p,b),{createNewFastAnalysis:C}=U(d.current),{onReportDelete:_,handleReportGenerated:A,handleReportParsed:R,handleThinkingStreamClosed:q}=B(e,t,y,g,m,h,j,d.current);(0,l.useSyncExternalStore)(i.current.subscribeToDraftChanges,i.current.getDraft);let z=(0,l.useMemo)(()=>{if(!y||!h[g])return null;let e=D(g,y,h);return h[g][e]?h[g][e].find(e=>String(e.itemId)===String(y)):null},[y,h,g]),F=(0,l.useCallback)(()=>{if((null==z?void 0:z.itemType)!=="query-data"||!z.treeManager)return;let e=z.treeManager.getAll(),{id:t}=(0,n.b)(Object.keys(e));if(!t||t===z.treeManager.getActiveAnalysisId())return;let r=e[t].rootAnalysisId;z.treeManager.setActiveAnalysisId(t),z.treeManager.setActiveRootAnalysisId(r)},[z]),H=(0,l.useCallback)((e,t)=>{let r=(0,n.g)();return -1!==u.indexOf(t)&&z?(null==z?void 0:z.itemType)==="query-data"?C({question:e,projectName:t,analysisId:r,rootAnalysisId:z.itemId,treeManager:z.treeManager}):void 0:w({question:e,projectName:t,analysisId:r,selectedItem:z,createNewFastAnalysis:C,setOracleHistory:j,updateUrlWithItemId:m,setSelectedItemId:b,setSelectedProjectName:p,messageManager:d.current})},[u,z,C,m,j,b,p,d]);(0,l.useEffect)(()=>{let e=()=>{m(null),b(null)};return window.addEventListener("oracle:new-report",e),()=>window.removeEventListener("oracle:new-report",e)},[m,b]);let Q=(0,l.useMemo)(()=>s.j.jsx(v,{selectedProjectName:g,projectNames:u,uploadNewProjectOption:o,hasUploadedFiles:!1,onProjectChange:k}),[g,u,o,!1,k]),W=(0,l.useMemo)(()=>s.j.jsx(f,{uploadNewProjectOption:o,selectedItem:z,projectName:g,onNewProjectCreated:N,createNewFastAnalysis:H,onReportGenerated:A,setSelectedItemId:b},"search"),[o,z,g,N,H,A,b]);return I?s.j.jsx(T,{error:I}):S?(console.log("OracleEmbed is in loading state"),s.j.jsx(P,{message:"Loading project data..."})):s.j.jsx(a.O.Provider,{value:{token:t,apiEndpoint:e,searchBarManager:i.current},children:s.j.jsxs(s.a.Provider,{value:d.current,children:[s.j.jsx(s.b,{rootClassNames:"absolute left-0 right-0"}),s.j.jsxs("div",{className:"flex flex-row min-w-full min-h-full max-h-full h-full text-gray-600 bg-white dark:bg-gray-900",children:[s.j.jsx(x,{oracleHistory:h,selectedProjectName:g,uploadNewProjectOption:o,selectedItemId:y,updateUrlWithItemId:m,projectSelector:Q,setSelectedItem:e=>{b(null==e?void 0:e.itemId)}}),s.j.jsx(E,{apiEndpoint:e,token:t,selectedItemId:y,selectedItem:z,selectedProjectName:g,uploadNewProjectOption:o,searchBar:W,onReportDelete:_,onReportParsed:R,onThinkingStreamClosed:q,setMostVisibleAnalysisAsActive:F,onProjectCreated:N})]})]})})}function W(){return s.j.jsx("div",{className:"w-full h-full min-h-60 flex flex-col justify-center items-center text-center rounded-md p-2 bg-white dark:bg-gray-800",children:s.j.jsxs("div",{className:"mb-2 text-sm text-gray-400 dark:text-gray-200",children:[s.j.jsx(s.d,{classNames:"w-5 h-5"}),"Loading"]})})}function V({error:e}){return s.j.jsx("div",{className:"w-full h-full min-h-60 flex flex-col justify-center items-center bg-rose-100 dark:bg-rose-900 text-red text-center rounded-md p-2",children:s.j.jsx("div",{className:"mb-2 text-sm text-rose-500 dark:text-rose-400",children:e})})}function K({analysis:e,viewMode:t,showSqlQuery:r,setShowSqlQuery:l}){return s.j.jsxs("div",{className:"flex flex-col space-y-4",children:[e.question&&s.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:s.j.jsxs("div",{className:"flex items-start gap-2",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),s.j.jsxs("div",{children:[s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"SQL Analysis"}),s.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.question})]})]})}),s.j.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.j.jsxs("span",{className:"inline-flex items-center gap-1 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 text-xs font-medium px-2.5 py-1 rounded",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[s.j.jsx("path",{d:"M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"}),s.j.jsx("path",{d:"M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"}),s.j.jsx("path",{d:"M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"})]}),(null==e?void 0:e.db_name)||"Database"]}),e.rows&&s.j.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900/30 dark:text-blue-300",children:[e.rows.length," ",1===e.rows.length?"row":"rows"]})]}),s.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 overflow-hidden",children:[s.j.jsxs("div",{className:"flex flex-wrap items-center justify-between p-3 border-b dark:border-gray-600 bg-gray-50 dark:bg-gray-700",children:[s.j.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-0",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 dark:text-indigo-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("polyline",{points:"16 18 22 12 16 6"}),s.j.jsx("polyline",{points:"8 6 2 12 8 18"})]}),s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"table"===t?"SQL Results":"SQL Chart"})]}),(null==e?void 0:e.sql)&&s.j.jsxs("button",{onClick:()=>l(!r),className:"text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded px-2 py-1 transition-colors flex items-center gap-1",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[s.j.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),s.j.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}),r?"Hide SQL":"Show SQL"]})]}),r&&(null==e?void 0:e.sql)&&s.j.jsxs("div",{className:"border-b dark:border-gray-700",children:[s.j.jsxs("div",{className:"flex flex-wrap items-center justify-between px-3 py-2 bg-gray-100 dark:bg-gray-700",children:[s.j.jsxs("div",{className:"flex items-center gap-1.5 mb-2 sm:mb-0",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-500 dark:text-purple-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("path",{d:"M8 9l3 3-3 3"}),s.j.jsx("line",{x1:"13",y1:"15",x2:"16",y2:"15"}),s.j.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})]}),s.j.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:"SQL Query"})]}),s.j.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(e.sql||"")},className:"text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded px-1.5 py-0.5 transition-colors flex items-center gap-1",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:[s.j.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),s.j.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]}),"Copy"]})]}),s.j.jsx("div",{className:"max-h-[150px] sm:max-h-[200px] overflow-auto",children:s.j.jsx(a.i,{code:e.sql||"",language:"sql",editable:!1,className:"text-sm"})})]}),s.j.jsx("div",{className:"p-2 sm:p-3",children:"table"===t?s.j.jsx("div",{className:"w-full overflow-x-auto",children:s.j.jsx(s.T,{columns:e.columns,rows:e.rows,columnHeaderClassNames:"py-2",skipColumns:["index"],rootClassNames:"shadow-sm min-w-[400px]"})}):s.j.jsx(a.E,{children:s.j.jsx("div",{className:"min-h-[250px] sm:min-h-[300px]",children:s.j.jsx(a.b,{rows:e.rows,columns:e.columns,initialQuestion:e.question,initialOptionsExpanded:!1},`chart-${e.analysis_id}`)})})})]})]})}function $({analysis:e}){var t,r,l;return s.j.jsxs("div",{className:"flex flex-col space-y-4",children:[(null==(t=e.inputs)?void 0:t.question)&&s.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:s.j.jsxs("div",{className:"flex items-start gap-2",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),s.j.jsxs("div",{children:[s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Question"}),s.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.inputs.question})]})]})}),(null==(r=e.result)?void 0:r.answer)&&s.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 p-4",children:[s.j.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b dark:border-gray-600",children:[s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500 dark:text-green-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.j.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Answer from Web Search"})]}),s.j.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:a.m.parse(e.result.answer)}})]}),(null==(l=e.result)?void 0:l.reference_sources)&&Array.isArray(e.result.reference_sources)&&e.result.reference_sources.length>0&&s.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600 p-3 sm:p-4",children:[s.j.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b dark:border-gray-600",children:[s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 dark:text-indigo-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.j.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})}),s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Reference Sources"})]}),s.j.jsx("ul",{className:"space-y-2",children:e.result.reference_sources.map((e,t)=>s.j.jsxs("li",{className:"flex items-start",children:[s.j.jsx("span",{className:"inline-flex items-center justify-center h-5 w-5 rounded-full bg-indigo-100 dark:bg-indigo-900 text-xs text-indigo-700 dark:text-indigo-300 mr-2 flex-shrink-0",children:t+1}),s.j.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline hover:text-blue-800 dark:hover:text-blue-300 break-all",children:e.source})]},t))})]})]})}function G({analysis:e}){var t;return s.j.jsxs("div",{className:"flex flex-col space-y-4",children:[(null==(t=e.inputs)?void 0:t.question)&&s.j.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600",children:s.j.jsxs("div",{className:"flex items-start gap-2",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.j.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.j.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),s.j.jsxs("div",{children:[s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Question"}),s.j.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.inputs.question})]})]})}),s.j.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 p-3 sm:p-4",children:[s.j.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b dark:border-gray-600",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),s.j.jsx("polyline",{points:"14 2 14 8 20 8"}),s.j.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),s.j.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),s.j.jsx("polyline",{points:"10 9 9 9 8 9"})]}),s.j.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"PDF Citations"})]}),e.result.citations.map((e,t)=>s.j.jsxs("div",{className:"mb-4 relative group",children:[s.j.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none py-1",dangerouslySetInnerHTML:{__html:a.m.parse(e.text)}}),e.citations&&Array.isArray(e.citations)&&e.citations.length>0&&s.j.jsxs(s.j.Fragment,{children:[s.j.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 flex flex-wrap items-center",children:[s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1 flex-shrink-0 text-blue-500 dark:text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),s.j.jsx("polyline",{points:"14 2 14 8 20 8"})]}),s.j.jsx("span",{className:"italic mr-1",children:"Source:"}),s.j.jsx("span",{className:"break-all",children:e.citations[0].document_title}),e.citations[0].start_page_number&&s.j.jsxs("span",{className:"ml-1",children:["(Pages ",e.citations[0].start_page_number,"-",e.citations[0].end_page_number,")"]})]}),s.j.jsx("div",{className:"absolute left-0 right-0 -bottom-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible md:transition-all md:duration-200 transform translate-y-full z-10",children:s.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600 mt-2 shadow-lg",children:[s.j.jsx("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Cited Text:"}),s.j.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 italic bg-gray-100 dark:bg-gray-800 p-2 rounded",children:['"',e.citations[0].cited_text,'"']})]})}),s.j.jsx("button",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1 block md:hidden",onClick:e=>{var t;let r=null==(t=e.currentTarget.parentElement)?void 0:t.querySelector(".mobile-citation-panel");r&&r.classList.toggle("hidden")},children:"View citation"}),s.j.jsx("div",{className:"mobile-citation-panel hidden mt-2 md:hidden",children:s.j.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border dark:border-gray-600 shadow-sm",children:[s.j.jsx("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Cited Text:"}),s.j.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 italic bg-gray-100 dark:bg-gray-800 p-2 rounded",children:['"',e.citations[0].cited_text,'"']})]})})]})]},t))]})]})}function Z({citations:e,setSelectedAnalysisIndex:t}){let{analyses:r}=(0,l.useContext)(a.t),[n,o]=(0,l.useState)(new Set),[i,d]=(0,l.useState)(new Set),[c,m]=(0,l.useState)("table"),[u,x]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{if(!e||!r)return;let t=new Set;e.forEach(e=>{if(e.citations&&Array.isArray(e.citations)&&e.citations.length>0){let a=e.citations[0].document_title;if(a){let e=a.split(":");if(e.length>=2){let a=e[e.length-1].trim();r.some(e=>e.analysis_id===a)&&t.add(a)}}}}),o(t)},[e,r]),!e||0===e.length)return null;let g=(e,t)=>{let a=t.split(":");if(a.length<2)return;let s=a[a.length-1].trim();-1!==r.findIndex(e=>e.analysis_id===s)&&d(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},p=(e,t)=>{if(!r||-1===t)return null;let a=r[t];return e.includes("text_to_sql")?s.j.jsxs("div",{className:"mt-2 border-l-2 border-blue-400 pl-3 py-2 bg-white dark:bg-gray-800 rounded",children:[s.j.jsxs("div",{className:"flex items-center justify-start space-x-2 mb-3",children:[s.j.jsx("button",{onClick:()=>m("table"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${"table"===c?"bg-primary-highlight text-gray-200 dark:bg-blue-600 dark:text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Table"}),s.j.jsx("button",{onClick:()=>m("chart"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${"chart"===c?"bg-primary-highlight text-gray-200 dark:bg-blue-600 dark:text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Chart"})]}),s.j.jsx(K,{analysis:a,viewMode:c,showSqlQuery:u,setShowSqlQuery:x})]}):e.includes("pdf_citations")?s.j.jsx("div",{className:"mt-2 border-l-2 border-blue-400 pl-3 py-2 bg-white dark:bg-gray-800 rounded",children:s.j.jsx(G,{analysis:a})}):e.includes("web_search")?s.j.jsx("div",{className:"mt-2 border-l-2 border-blue-400 pl-3 py-2 bg-white dark:bg-gray-800 rounded",children:s.j.jsx($,{analysis:a})}):s.j.jsx("div",{className:"mt-2 border-l-2 border-blue-400 pl-3 py-2 text-sm bg-white dark:bg-gray-800 rounded",children:s.j.jsx("div",{className:"font-medium mb-1 text-gray-700 dark:text-gray-200",children:"Analysis"})})};return s.j.jsx("div",{className:"flex flex-col space-y-4 mt-10",children:s.j.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-600 py-3 px-3 sm:px-5 lg:px-7",children:(()=>{let t=new Set;return e.filter(e=>{let t=e.citations&&Array.isArray(e.citations)&&e.citations.length>0,r=String(e.text&&e.text.trim().length>0?a.m.parse(e.text):"").replace(/<[^>]*>/g,"").trim().length>0;return t||r}).map((e,l)=>{var n;let o=e.citations&&Array.isArray(e.citations)&&e.citations.length>0,d=o?null==(n=e.citations[0].document_title.split(":").pop())?void 0:n.trim():null,c=d&&!t.has(d);c&&d&&t.add(d);let m=String(e.text&&e.text.trim().length>0?a.m.parse(e.text):""),u=m.replace(/<[^>]*>/g,"").trim().length>0;return s.j.jsxs("div",{className:"mb-4 relative group",children:[u&&s.j.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none py-1",dangerouslySetInnerHTML:{__html:m}}),o&&s.j.jsxs(s.j.Fragment,{children:[c&&s.j.jsxs("div",{className:"text-xs border border-gray-200 dark:border-gray-600 rounded-md p-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 mt-1 flex flex-wrap items-center cursor-pointer hover:border-blue-400 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>g(l,e.citations[0].document_title),children:[s.j.jsxs("div",{className:"flex items-center w-full",children:[e.citations[0].document_title.includes("text_to_sql")&&s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1.5 flex-shrink-0 text-blue-500 dark:text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.j.jsx("path",{d:"M4 6h16M4 12h16m-7 6h7"})}),e.citations[0].document_title.includes("pdf_citations")&&s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1.5 flex-shrink-0 text-blue-500 dark:text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),s.j.jsx("polyline",{points:"14 2 14 8 20 8"})]}),e.citations[0].document_title.includes("web_search")&&s.j.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1.5 flex-shrink-0 text-blue-500 dark:text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.j.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.j.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),s.j.jsx("span",{className:"break-all flex-grow",children:"Dig Deeper"}),s.j.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3.5 w-3.5 ml-1 text-blue-500 dark:text-blue-400 transition-transform ${i.has(l)?"rotate-180":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.j.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),e.citations[0].start_page_number&&s.j.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs mt-1",children:["Pages ",e.citations[0].start_page_number,"-",e.citations[0].end_page_number]})]}),i.has(l)&&s.j.jsx("div",{className:"mt-2 transition-all duration-200 ease-in-out max-h-[500px] overflow-y-auto",children:p(e.citations[0].document_title,r.findIndex(t=>{var r;return t.analysis_id===(null==(r=e.citations[0].document_title.split(":").pop())?void 0:r.trim())}))})]})]},l)})})()})})}function Y({apiEndpoint:e,reportId:t,projectName:r,token:n,onReportParsed:o=()=>{},onDelete:i=()=>{}}){let[d,c]=(0,l.useState)({}),[m,u]=(0,l.useState)([]),[x,g]=(0,l.useState)([]),[p,h]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[b,f]=(0,l.useState)(null),[v,w]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(!1!==v||null===p)&&t&&r&&(async(t,r)=>{try{w(!0);let s=await (0,a.x)(e,t,r,n);s.parsed.mdx&&h(s.parsed.mdx),s.parsed.tables&&c(s.parsed.tables),s.analyses&&u(s.analyses),s.comments&&g(s.comments),s.report_with_citations&&y(s.report_with_citations),o&&o(s)}catch(e){console.error(e),f(e.message||String(e))}finally{w(!1)}})(t,r)},[t]),v?s.j.jsx(W,{}):b?s.j.jsx(V,{error:b}):(m.filter(e=>!(null!=e&&e.error)||""===e.error),s.j.jsx(a.t.Provider,{value:{apiEndpoint:e,tables:d,multiTables:{},images:{},analyses:m,executiveSummary:{title:"",introduction:"",recommendations:[]},reportId:t,projectName:r,token:n,commentManager:(0,a.u)({apiEndpoint:e,reportId:t,projectName:r,token:n,initialComments:x})},children:s.j.jsx("div",{className:"relative overflow-auto",children:s.j.jsx("div",{className:"relative oracle-report-ctr w-full",children:j&&j.length>0?s.j.jsxs("div",{className:"w-full max-w-none sm:max-w-3xl lg:max-w-4xl xl:max-w-5xl 2xl:max-w-6xl mx-auto py-2 px-2 sm:px-4 md:px-6 mb-12 md:mb-0",children:[s.j.jsx(es,{onDelete:i}),s.j.jsx(Z,{citations:j})]}):s.j.jsx(a.v,{extensions:a.w,content:p,immediatelyRender:!1,editable:!1,slotBefore:s.j.jsx(es,{onDelete:i}),editorProps:{attributes:{class:"w-full max-w-none sm:max-w-3xl lg:max-w-4xl xl:max-w-5xl 2xl:max-w-6xl oracle-report-tiptap relative prose prose-base dark:prose-invert mx-auto py-2 px-2 sm:px-4 md:px-6 mb-12 md:mb-0 focus:outline-none *:cursor-default"}}})})})}))}let J={DONE:"DONE",ERRORED:"ERRORED",THINKING:"THINKING",INITIALIZED:"INITIALIZED"},X=(e,t,r)=>{let a=new Blob([e],{type:r}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},ee=(e,t="report.md")=>{X((0,a.y)(e),t,"text/markdown")},et=async(e,t="report.pdf")=>{let r=(0,a.y)(e),s=await a.m.parse(r),l=document.createElement("div");l.innerHTML=s,l.style.position="absolute",l.style.left="-9999px",l.style.top="-9999px",l.style.width="800px",l.classList.add("prose","prose-base"),document.body.appendChild(l);try{let e=window.open("","_blank");if(!e)throw Error("Could not open print window");let r=e.document;r.write(`
      <html>
        <head>
          <title>${t}</title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
              line-height: 1.6;
              color: #333;
              max-width: 800px;
              margin: 0 auto;
              padding: 20px;
            }
            h1, h2, h3, h4, h5, h6 {
              margin-top: 1.5em;
              margin-bottom: 0.5em;
              font-weight: 600;
            }
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            h3 { font-size: 1.25em; }
            p { margin: 1em 0; }
            ul, ol { padding-left: 2em; }
            blockquote {
              border-left: 4px solid #ddd;
              padding-left: 1em;
              color: #666;
              margin: 1em 0;
            }
            code {
              font-family: Menlo, Monaco, 'Courier New', monospace;
              background-color: #f5f5f5;
              padding: 0.2em 0.4em;
              border-radius: 3px;
              font-size: 0.9em;
            }
            pre {
              background-color: #f5f5f5;
              padding: 1em;
              border-radius: 5px;
              overflow-x: auto;
            }
            pre code {
              background-color: transparent;
              padding: 0;
            }
            table {
              border-collapse: collapse;
              width: 100%;
              margin: 1em 0;
            }
            th, td {
              text-align: left;
              padding: 8px;
              border-bottom: 1px solid #ddd;
            }
            th {
              background-color: #f5f5f5;
              font-weight: 600;
            }
            img {
              max-width: 100%;
              height: auto;
            }
            a {
              color: #0366d6;
              text-decoration: none;
            }
            /* Print-specific styles */
            @media print {
              /* General print settings */
              body {
                padding: 0;
                margin: 0;
              }
              
              /* Hide URL, date, and page numbers */
              @page {
                margin: 1cm;
                size: auto;
              }
              
              /* Chrome, Safari, Edge */
              @page {
                size: auto;
                margin: 5mm 10mm;
                margin-header: 0;
                margin-footer: 0;
              }
              
              /* Hide header and footer completely */
              html {
                -webkit-print-color-adjust: exact !important;
              }
              
              /* Hide any browser-specific headers and footers */
              body {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
          </style>
        </head>
        <body>
          ${s}
          
          <script>
            // This script runs in the print window to assist with print settings
            document.addEventListener('DOMContentLoaded', function() {
              // Add a small delay for browsers to process the content
              setTimeout(function() {
                // Some additional print settings via script
                const style = document.createElement('style');
                style.textContent = 
                  "@media print {" +
                    "/* More specific fixes for different browsers */" +
                    "body::before, body::after { display: none !important; }" +
                    "header, footer { display: none !important; }" +
                    
                    "/* Ensure our content is visible */" +
                    "body { -webkit-print-color-adjust: exact !important; }" +
                  "}";
                document.head.appendChild(style);
              }, 100);
            });
          </script>
        </body>
      </html>
    `),r.close(),setTimeout(()=>{e.matchMedia&&e.matchMedia("print").addEventListener("change",function(t){t.matches||setTimeout(()=>e.close(),100)}),e.print()},500)}finally{document.body.removeChild(l)}},er=(e=new Date)=>e.toISOString().replace("Z","");function ea({onClose:e}){let{commentManager:t}=(0,l.useContext)(a.t),r=(0,l.useSyncExternalStore)((null==t?void 0:t.subscribeToCommentUpdates)||(()=>()=>{}),(null==t?void 0:t.getComments)||(()=>[]));return s.j.jsxs("div",{className:"w-64 h-full flex flex-col",children:[s.j.jsx("div",{className:"h-[3.5rem] invisible"}),s.j.jsxs("div",{className:"flex-1 border-l border-gray-200 dark:border-gray-700 overflow-y-auto bg-white dark:bg-gray-800 shadow-lg",children:[s.j.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:s.j.jsxs("div",{className:"flex items-center justify-between",children:[s.j.jsxs("div",{className:"flex items-center gap-2",children:[s.j.jsx(c,{className:"w-5 h-5"}),s.j.jsx("h2",{className:"text-lg font-semibold",children:"Comments"}),s.j.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",r.length,")"]})]}),s.j.jsx(s.B,{variant:"secondary",onClick:e,className:"hover:bg-gray-100 dark:hover:bg-gray-700 p-1",children:s.j.jsx(s.X,{className:"w-5 h-5"})})]})}),s.j.jsx("div",{className:"p-4",children:0===r.length?s.j.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No comments yet"}):s.j.jsx("div",{className:"space-y-4",children:r.map(e=>s.j.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-700",children:[e.user&&s.j.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e.user}),s.j.jsx("div",{className:(0,s.t)("text-sm text-gray-600 dark:text-gray-300",!e.content&&"text-gray-300"),children:e.content||"Blank comment"})]},e.id))})})]})]})}let es=({onDelete:e=()=>{}})=>{let[t,r]=(0,l.useState)(!1),[n,o]=(0,l.useState)(!1),i=(0,l.useContext)(s.a),{apiEndpoint:m,reportId:u,projectName:x,token:g,commentManager:p}=(0,l.useContext)(a.t),h=(0,l.useRef)(null),[j,y]=(0,l.useState)(null),b=(0,l.useSyncExternalStore)((null==p?void 0:p.subscribeToCommentUpdates)||(()=>()=>{}),(null==p?void 0:p.getComments)||(()=>[])),{editor:f}=(0,a.z)(),v=(0,l.useRef)({});(0,l.useEffect)(()=>{if(b&&b.length>0){let e={};b.forEach(t=>{e[t.id]={id:t.id,commentContent:t.content,user:t.user,htmlSnippet:"",commentRelevantText:t.content}}),v.current=e}},[b]);let w=null==j?void 0:j.startsWith("Revision in progress"),k=()=>{v.current={};let e=null==f?void 0:f.state.doc;e&&(e.nodesBetween(0,e.content.size,(e,t,r)=>{var a;for(let r of e.marks)if("comment"===r.type.name){let s=t+e.textContent.length,l=r.attrs.commentId,n=b.find(e=>e.id===l);if(!n)continue;let o=!1,i=0,d=e,c=t;for(;!o&&i<10&&d;){f.commands.setNodeSelection(c);let e=f.state.selection.$from.parent;"doc"===e.type.name?o=!0:(d=e,c=null==(a=f.state.selection)?void 0:a.from),f.commands.selectParentNode(),i++}v.current[l]?(v.current[l].topParent=d,v.current[l].topParentPos=c,t<v.current[l].startPos&&(v.current[l].startPos=t),s>v.current[l].endPos&&(v.current[l].endPos=s)):v.current[l]={id:l,topParent:d,topParentPos:c,htmlSnippet:"",commentContent:n.content,commentRelevantText:"",startPos:t,endPos:s,user:n.user}}return!0}),Object.values(v.current).forEach(e=>{let t="",r=(t="text"===e.topParent.type.name?"<span class='oracle-report-comment' data-comment-id='temp'>"+e.topParent.textContent+"</span>":"recommendationTitle"===e.topParent.type.name?"## <span class='oracle-report-comment' data-comment-id='temp'>"+e.topParent.textContent+"</span>":'<span class="oracle-report-comment" data-comment-id="temp">'+f.storage.markdown.serializer.serialize(e.topParent)+"</span>").replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"");e.commentRelevantText=r,e.htmlSnippet=t}))},[N,S]=(0,l.useState)(!1);if(!f)return null;let[I,C]=(0,l.useState)(!1),_=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=e=>{_.current&&!_.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),s.j.jsxs("div",{className:"flex flex-col",children:[s.j.jsxs("div",{className:"flex items-center flex-row-reverse justify-between px-4 py-2 border-b dark:border-gray-700",children:[s.j.jsxs("div",{className:"relative flex gap-2",children:[s.j.jsxs("div",{className:"relative",children:[s.j.jsx(s.B,{variant:"secondary",onClick:()=>{k(),o(!n)},className:n?"bg-gray-100 dark:bg-gray-700":"",children:s.j.jsx(c,{className:"w-5 h-5"})}),b.length>0&&s.j.jsx("div",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:b.length})]}),s.j.jsxs("div",{className:"relative",ref:_,children:[s.j.jsx(s.B,{variant:"secondary",onClick:()=>C(!I),className:I?"bg-gray-100 dark:bg-gray-700":"",children:s.j.jsx(s.D,{className:"w-5 h-5"})}),I&&s.j.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 border dark:border-gray-700",children:s.j.jsxs("div",{className:"py-1",children:[s.j.jsxs("button",{onClick:()=>{f&&(ee(f.storage.markdown.getMarkdown(),`report-${u}.md`),C(!1))},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[s.j.jsx(d,{className:"w-4 h-4 mr-2"}),"Export as Markdown"]}),s.j.jsxs("button",{onClick:()=>{f&&(et(f.storage.markdown.getMarkdown(),`report-${u}.pdf`),C(!1))},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[s.j.jsx(d,{className:"w-4 h-4 mr-2"}),"Export as PDF"]})]})})]})]}),s.j.jsx(s.B,{variant:"danger",onClick:()=>S(!0),children:"Delete"}),s.j.jsx(s.e,{open:N,onOk:()=>{e(u,x),S(!1)},onCancel:()=>S(!1),okText:"Yes",okVariant:"danger",children:"Are you sure?"})]}),w&&s.j.jsxs("div",{className:"w-96 my-4 rounded-full border dark:border-none mx-auto bg-gray-50 dark:bg-gray-600 text-sm text-gray-600 dark:text-gray-300 p-4 flex flex-row shadow-md items-center",children:[s.j.jsx(s.I,{className:"min-w-6 mr-2 text-blue-500 dark:text-blue-400"}),s.j.jsx("p",{children:"This report is currently being revised. This page will refresh when the revision completes."})]}),n&&s.j.jsx("div",{className:"fixed right-0 top-0 bottom-0 z-[100]",children:s.j.jsx(ea,{onClose:()=>o(!1)})}),j&&s.j.jsx("div",{className:`fixed bottom-6 ${n?"right-72":"right-6"} z-[110] transition-all duration-200`,children:s.j.jsx(s.B,{variant:"primary",onClick:()=>{k(),r(!0)},disabled:!j||w,className:"shadow-lg hover:shadow-xl transition-shadow",children:"Submit for revision"})}),s.j.jsx(s.e,{rootClassNames:"w-full z-10",open:t,onCancel:()=>r(!1),onOk:()=>{var e;try{(0,a.D)(m,u,x,g,null==(e=h.current)?void 0:e.value,b.map(e=>({relevant_text:e.content,comment_text:e.content}))).then(e=>{r(!1)}).catch(e=>{console.error(e),i.error(e.message)})}catch(e){i.error(e.message)}},title:"Revise report",okText:"Submit",className:"dark:bg-gray-800 dark:text-gray-200",contentClassNames:"overflow-auto",children:s.j.jsxs("div",{className:"flex flex-row flex-wrap gap-4",children:[Object.values(v.current).map((e,t)=>s.j.jsxs("div",{className:"revise-modal-comment-container w-full",children:[s.j.jsx("div",{className:"revise-modal-header",children:"Highlighted text"}),s.j.jsx(a.v,{content:e.htmlSnippet,extensions:a.B,immediatelyRender:!1,editable:!1,editorProps:{attributes:{class:"revise-modal-highlight prose prose-sm dark:prose-invert focus:outline-none *:cursor-default"}}}),s.j.jsx("div",{className:"revise-modal-header",children:"Your comment"}),s.j.jsx("textarea",{className:"text-sm revise-modal-comment-text w-full h-full focus:ring-0 border-none outline-none",defaultValue:e.commentContent,placeholder:"Type your comment here",onChange:t=>{v.current[e.id].commentContent=t.target.value,null==p||p.updateComments(f,Object.values(v.current).map(e=>({id:e.id,content:e.commentContent,user:e.user})))}})]},e.id)),s.j.jsxs("div",{className:"w-full revise-modal-comment-container overflow-hidden",children:[s.j.jsx("div",{className:"revise-modal-header",children:"General comments"}),s.j.jsx(s.i,{autoResize:!0,placeholder:"Add general comments here",rootClassNames:"border-none",textAreaClassNames:"rounded-none ring-0",ref:h,textAreaHtmlProps:{resize:"none"}})]})]})})]})}}}]);