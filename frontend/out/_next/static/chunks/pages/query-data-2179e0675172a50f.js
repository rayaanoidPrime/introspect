(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{2664:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/query-data",function(){return t(6283)}])},5494:(e,a,t)=>{"use strict";t.d(a,{A:()=>d});var r=t(8017),n=t(4109),s=t(7847),l=t(2301),o=t(44),i=t(2074);let d=e=>{let{id:a,userType:t,children:d,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[h,f]=(0,n.useState)([]),g=(0,s.useRouter)(),y=e=>{g.push(e)},p=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),y("/log-in")},j=(0,o.usePathname)();return(0,n.useEffect)(()=>{let e=[];f(("ADMIN"==t?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:t?[{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:[]).map(e=>(e.current=e.href==j,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==j,e))),e)))},[t]),(0,r.jsxs)("div",{className:(0,i.QP)(m,c),children:[h.length?(0,r.jsx)(l.jq,{rootClassNames:(0,i.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:h.map(e=>({...e,classNames:(0,i.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)("div",{className:u,children:d})]})}},6283:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>p});var r=t(8017),n=t(4109),s=t(7847),l=t(7961),o=t(5494),i=t(2301),d=t(5107),c=t(6092),u=t(4170);function m({metadata:e=null}){(0,n.useMemo)(()=>e&&Array.isArray(e)?Array.from(new Set(e.map(e=>e.table_name))):[],[e]);let a=Array.isArray(e)?[{dataIndex:"table_name",title:"table_name",key:"table_name"},{dataIndex:"column_name",title:"column_name",key:"column_name"},{dataIndex:"column_description",title:"column_description",key:"column_description"},{dataIndex:"data_type",title:"data_type",key:"data_type"}]:[];return e?u.j.jsx(d.M,{children:Array.isArray(e)&&u.j.jsx(u.j.Fragment,{children:u.j.jsx("div",{className:"flex flex-col justify-center w-full",children:u.j.jsx(u.T,{pagination:{defaultPageSize:10},paginationPosition:"top",rootClassNames:"rounded-md max-w-full",columns:a,rows:e,columnHeaderClassNames:"py-2"})})})}):u.j.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gray-50 text-sm text-gray-400",children:"No metadata available"})}function h({apiEndpoint:e,token:a,initialProjectList:t=[],initialTrees:r={},hideRawAnalysis:s=!1,hiddenCharts:l=[],hideSqlTab:o=!1,hidePreviewTabs:i=!1,searchBarDraggable:h=!1,onTreeChange:f=(...e)=>{}}){let[g,y]=(0,n.useState)(!1),[p,j]=(0,n.useState)((0,d.N)({token:a,hideRawAnalysis:s,hiddenCharts:l,hideSqlTab:o,hidePreviewTabs:i,apiEndpoint:e}));p.updateConfig=e=>{j(a=>({...a,...e}))};let{current:x}=(0,n.useRef)(crypto.randomUUID().toString()),[b,N]=(0,n.useState)(t),_=(0,n.useRef)(t.reduce((e,a)=>(e[a.name]={projectName:a.name,predefinedQuestions:a.predefinedQuestions,treeManager:(0,d.P)(r[a.name]||{})},e),{})),[w,v]=(0,n.useState)(null),{current:k}=(0,n.useRef)((0,u.M)()),[S,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{!async function(){let t={};for await(let r of b)if(r.name!==x)try{let n=await (0,c.a)(e,a,r.name);t[r.name]=n}catch(e){console.error(e),t[r.name]=null}let r=b.map(e=>({...e,metadata:t[e.name]}));v(r[0]),N(r),y(!0)}()},[]);let C=(0,n.useMemo)(()=>w&&g?u.j.jsx(u.S,{label:"Select database",popupClassName:"!max-w-full",rootClassNames:"mb-2",value:null==w?void 0:w.name,allowClear:!1,placeholder:"Select Database",allowCreateNewOption:!1,options:[{value:x,label:"Upload new"}].concat(b.map(e=>({value:e.name,label:e.name}))),onChange:e=>{let a=b.find(a=>a.name===e);e===x?T(!0):v(a||b[0])}}):null,[w,b]),P=(0,n.useRef)(null);(0,n.useEffect)(()=>{P.current&&(v(b.find(e=>e.name===P.current)||b[0]),P.current=null)},[b]);let E=(0,n.useMemo)(()=>w&&g?u.j.jsx(d.M,{children:u.j.jsx(d.Q,{defaultSidebarOpen:!0,beforeTitle:C,searchBarDraggable:h,projectName:w.name,metadata:w.metadata,analysisTreeManager:_.current[w.name].treeManager,autoScroll:!0,predefinedQuestions:w.predefinedQuestions||[],onTreeChange:(e,a)=>{try{f(e,a)}catch(e){console.error(e)}}})}):null,[w,C,g]),A=(0,n.useMemo)(()=>w&&g?u.j.jsx(m,{metadata:w.metadata}):null,[b,w,g,C]),I=(0,n.useMemo)(()=>[{name:"Query",content:E},{name:"View data structure",content:A}],[E,A]),M=(0,n.useMemo)(()=>u.j.jsx(d.C,{apiEndpoint:e,token:a,onProjectCreated:async t=>{try{_.current={..._.current,[t]:{projectName:t,treeManager:(0,d.P)()}};let r=await (0,c.a)(e,a,t);N(e=>[...e,{name:t,predefinedQuestions:["What are the tables available?","Show me 5 rows"],metadata:r}]),k.success("Database uploaded successfully, access it by the name: "+t),P.current=t}catch(e){k.error(e)}finally{T(!1)}}}),[b]);return u.j.jsxs(u.a.Provider,{value:k,children:[u.j.jsx(u.b,{rootClassNames:"absolute left-0 right-0"}),u.j.jsx(d.R.Provider,{value:p,children:u.j.jsxs("div",{className:"relative w-full h-full p-2",children:[g?null!=b&&b.length?u.j.jsx(u.c,{size:"small",tabs:I,vertical:!0,contentClassNames:"p-0 mt-2 sm:mt-0 bg-white dark:bg-gray-800",defaultTabClassNames:"p-0 sm:mt-0 h-full",selectedTabHeaderClasses:e=>"Tree"===e?"bg-transparent":""}):u.j.jsx("div",{className:"w-full h-full flex items-center justify-center",children:M}):u.j.jsx("div",{className:"w-full h-full flex items-center justify-center",children:u.j.jsx(u.d,{})}),u.j.jsx(u.e,{contentClassNames:"h-full",title:"Upload new database",open:S,footer:!1,onCancel:()=>T(!1),children:M})]})})]})}var f=t(1e3);function g(e){let{token:a,dbs:t,hideSqlTab:s=!1,hidePreviewTabs:l=!1,hiddenCharts:o=[],hideRawAnalysis:d=!1}=e,[c,u]=(0,n.useState)(null),[m,g]=(0,n.useState)(!0),[y,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{fetch("".concat(f.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/get_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a})}).then(e=>e.ok?e.json():{error:"Could not fetch user history"}).then(e=>{if(e.error){p(e.error);return}g(!1),u(e.history||{})})},[]);let j=(0,n.useCallback)((e,t)=>{if(e&&t)try{fetch("".concat(f.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/update_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,history:t,db_name:e})}).then(e=>e.json()).then(e=>{if(e.error)throw Error(e.error)})}catch(e){console.error(e)}},[]);return m||y||!c?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:y?"".concat(y):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.c5,{})," Loading"]})}):(0,r.jsx)(h,{initialProjectList:t,hiddenCharts:["boxplot","histogram"],token:a,searchBarDraggable:!1,hidePreviewTabs:!1,apiEndpoint:f.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"",initialTrees:c,hideRawAnalysis:d,hideSqlTab:s,onTreeChange:(e,a)=>{j(e,a)}})}var y=t(1e3);let p=()=>{let e=(0,s.useRouter)(),[a,t]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[h,f]=(0,n.useState)([]),[p,j]=(0,n.useState)(!1),[x,b]=(0,n.useState)(!1),[N,_]=(0,n.useState)({}),w=async e=>{j(!0);let a=await fetch((y.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!a.ok)throw j(!1),Error("Failed to get api key names - are you sure your network is working?");let t=await a.json();if(f(t.db_names),!(a=await fetch((y.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_non_admin_config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})})).ok)throw j(!1),Error("Failed to get non admin config - are you sure your network is working?");_(t=await a.json()),j(!1)};console.log(N),(0,n.useEffect)(()=>{let a=localStorage.getItem("defogToken"),r=localStorage.getItem("defogUserType");if(c(localStorage.getItem("defogUser")),m(r),t(a),!a){b(!0),setTimeout(()=>{let a=window.location.pathname+window.location.search;e.push({pathname:"/log-in",query:{message:"You are not logged in. Please log in to access query data.",returnUrl:a}})},1500);return}w(a)},[e]);let v="ADMIN"===u;return(0,r.jsxs)("div",{className:"max-h-screen h-screen",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)(o.A,{id:"query-data",userType:u,containerClassNames:"max-h-screen h-screen flex flex-col",contentClassNames:"h-full max-h-full",children:x?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center text-gray-400 text-sm",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Not Logged In"}),(0,r.jsx)("p",{className:"mb-4",children:"You are not logged in. Redirecting to login page..."}),(0,r.jsx)(i.c5,{})]}):a?p?(0,r.jsxs)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:["Loading DBs ",(0,r.jsx)(i.c5,{classNames:"ml-4"})]}):(0,r.jsx)(g,{token:a,devMode:!1,isAdmin:v,hideSqlTab:!v&&N.hide_sql_tab_for_non_admin,hidePreviewTabs:!v&&N.hide_preview_tabs_for_non_admin,hiddenCharts:v?[]:N.hidden_charts_for_non_admin||[],hideRawAnalysis:!v&&N.hide_raw_analysis_for_non_admin,dbs:(h.length>0?h:[]).map(e=>({name:e,keyName:e,predefinedQuestions:"Manufacturing"===e?["What is the average rejection rate by lot?","Is there a difference in the plasticity of components that are rejected vs accepted?"]:"Sales"===e?["Who are our top 5 customers by revenue?","What was the month on month change in revenue?"]:"Slack"===e?["What is the count of number of queries by db type in the last 30 days, except for queries made by jp@defog.ai?","Which users have the most queries?"]:["Show me any 5 rows from the first table"]}))}):(0,r.jsx)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:"No token found. Please log out and log back in."})})]})}},7961:(e,a,t)=>{"use strict";t.d(a,{A:()=>l});var r=t(8017),n=t(6732),s=t.n(n);let l=()=>(0,r.jsxs)(s(),{children:[(0,r.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,r.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})}},e=>{var a=a=>e(e.s=a);e.O(0,[846,758,544,636,593,792],()=>a(2664)),_N_E=e.O()}]);