(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{7081:(e,s,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/evaluate-model",function(){return l(6392)}])},6389:(e,s,l)=>{"use strict";l.d(s,{A:()=>i});var a=l(5105),r=l(9035),t=l.n(r);let i=()=>(0,a.jsxs)(t(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},3360:(e,s,l)=>{"use strict";l.d(s,{A:()=>d});var a=l(5105),r=l(8101),t=l(3472),i=l(5379),n=l(6159),o=l(4799);let d=e=>{let{id:s,userType:l,children:d,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[h,p]=(0,r.useState)([]),x=(0,t.useRouter)(),f=e=>{x.push(e)},v=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),f("/log-in")},g=(0,n.usePathname)();return(0,r.useEffect)(()=>{p(("admin"==l?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"align-model",title:"Align Model",href:"/align-model"},{key:"evaluate-model",title:"Evaluate Model",href:"/evaluate-model"}]},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:v}]:l?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:v}]:[]).map(e=>(e.current=e.href==g,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==g,e))),e)))},[l]),(0,a.jsxs)("div",{className:(0,o.QP)(m,c),children:[h.length?(0,a.jsx)(i.jq,{rootClassNames:(0,o.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:h.map(e=>({...e,classNames:(0,o.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:u,children:d})]})}},6392:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>p});var a=l(5105),r=l(6389),t=l(3360),i=l(8101),n=l(9783),o=l(8756),d=l(7843),c=l(5710),u=l(4379),m=l(5379),h=l(3184);function p(){let[e,s]=(0,i.useState)([]),[l,p]=(0,i.useState)(null),[x,f]=(0,i.useState)(null),[v,g]=(0,i.useState)([]),[N,b]=(0,i.useState)({questions:[],sql:"",id:crypto.randomUUID()}),[y,j]=(0,i.useState)(""),[w,q]=(0,i.useState)(""),[S,k]=(0,i.useState)(!1),C=(0,i.useContext)(m.oS),_=(0,i.useMemo)(()=>N.questions.slice(0,-1),[N.questions]),A=(0,i.useMemo)(()=>N.questions.slice(-1),[N.questions]),E=async e=>{let l=await fetch((h.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!l.ok)throw Error("Failed to get api key names. Check your network?");s((await l.json()).db_names||[])};(0,i.useEffect)(()=>{let e=localStorage.getItem("defogToken");f(e),e&&E(e);let s=localStorage.getItem("defogDbSelected");s&&p(s)},[]),(0,i.useEffect)(()=>{l&&localStorage.setItem("defogDbSelected",l)},[l]);let T=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{k(e?e.id:"all");let s=await fetch((0,u.A)("http","readiness/regression_results"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:x,key_name:l,queries:e?[e]:v})}),a=(await s.json()).query_wise_results||{};g(e=>e.map(e=>{var s;return{...e,validationResult:null!==(s=a[e.id])&&void 0!==s?s:e.validationResult}}))}catch(e){console.error(e)}finally{k(!1)}},[v,l,x]),I=e=>{if(!(null==e?void 0:e.length))return;let s=e[0];if("application/json"!==s.type){C.error("Only JSON files accepted");return}let l=new FileReader;l.onload=e=>{var s;let l=null==e?void 0:null===(s=e.target)||void 0===s?void 0:s.result;if(l)try{let e=JSON.parse(l.toString());if(Array.isArray(e)){if(!e.every(e=>Array.isArray(e.questions)&&"string"==typeof e.sql)){C.error("Invalid JSON format. Must be array of { questions[], sql: string }");return}e.forEach(e=>{e.id=crypto.randomUUID(),e.validationResult=e.validationResult||null}),g(e),C.success("JSON uploaded successfully")}else C.error("Could not upload JSON (expected an array).")}catch(e){console.error(e),C.error("Could not parse JSON file.")}},l.readAsText(s)};return(0,a.jsxs)("div",{className:"flex justify-center",children:[(0,a.jsx)(r.A,{}),(0,a.jsxs)(t.A,{id:"view-feedback",userType:"admin",children:[e.length>1&&(0,a.jsx)("div",{className:"mb-4 w-full",children:(0,a.jsx)(m.Z,{placeholder:"Select API Key",rootClassNames:"w-full",options:e.map(e=>({value:e,label:e})),value:l||void 0,onChange:e=>p(e)})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 md:grid-cols-12 w-full bg-gray-50 rounded-md border gap-2 divide-x",children:[(0,a.jsxs)("div",{className:"col-span-4 p-4 flex flex-col items-center justify-center",children:[(0,a.jsx)("input",{type:"file",accept:".json",className:"hidden",id:"file-upload",onChange:e=>I(e.target.files)}),(0,a.jsx)(m.z8,{allowMultiple:!1,acceptedFileTypes:[".json"],onDrop:e=>{I(e.dataTransfer.files)},children:(0,a.jsx)("label",{htmlFor:"file-upload",className:"w-full cursor-pointer",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 text-center border border-dashed border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDC2ï¸"}),(0,a.jsx)("h1",{className:"font-bold text-sm mb-2",children:"Upload a JSON file"}),(0,a.jsx)("p",{children:"Click or drag files to this area to upload"})]})})})]}),(0,a.jsxs)("div",{className:"col-span-8 border-l",children:[(0,a.jsxs)("div",{className:"flex items-center border-b p-4 justify-between",children:[(0,a.jsx)("h1",{className:"text-sm font-bold text-gray-800",children:"Or add a question manually"}),(0,a.jsx)(m.$n,{variant:"primary",onClick:()=>{if(!N.questions.length&&y&&(N.questions.push(y),j("")),!N.questions.length){C.error("Please add at least one question");return}if(!N.sql){C.error("Please add the SQL query");return}g([{...N,id:crypto.randomUUID(),validationResult:null},...v]),b({questions:[],sql:"",id:crypto.randomUUID()})},children:"Add"})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-10 px-4 gap-3",children:[(0,a.jsxs)("div",{className:"col-span-4 flex flex-col p-4 border-r",children:[(0,a.jsxs)("div",{className:"previous-questions relative",children:[_.length>0&&(0,a.jsx)("div",{className:"absolute z-[2] top-0 -left-2 w-1 h-full border border-r-0 border-gray-300"}),_.map((e,s)=>(0,a.jsx)("div",{className:"relative group text-sm mb-1",children:(0,a.jsx)("div",{className:"flex flex-row items-center",children:e})},s))]}),(0,a.jsx)("div",{className:"main-question mt-2",children:A.map((e,s)=>(0,a.jsx)("div",{className:"relative group text-lg font-semibold mb-4",children:(0,a.jsx)("div",{className:"flex flex-row items-center",children:e})},s))}),(0,a.jsxs)("div",{className:"flex flex-col text-gray-500",children:[(0,a.jsx)("span",{className:"text-sm mb-2",children:N.questions.length?"Keep typing to add follow-up questions":"Type + press Enter to add a question"}),(0,a.jsx)(m.pd,{placeholder:"New question",value:y,onChange:e=>j(e.target.value),inputClassNames:"rounded-md p-1 px-2 border-gray-300",onPressEnter:e=>{y&&(b(e=>({...e,questions:[...e.questions,y]})),j(""))}})]})]}),(0,a.jsxs)("div",{className:"col-span-6 flex flex-col gap-2 p-4",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Enter the correct SQL for the final question here"}),(0,a.jsx)(d.Ay,{className:"border border-gray-300",extensions:[(0,c.ll)(),d.Lz.lineWrapping],value:N.sql,basicSetup:{lineNumbers:!1},editable:!0,onChange:e=>{b(s=>({...s,sql:e}))}})]})]})})]})]}),(0,a.jsx)("div",{className:"h-10 w-full flex items-center",children:(0,a.jsx)("div",{className:"h-0.5 w-full bg-gray-300"})}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md border",children:[(0,a.jsxs)("div",{className:"flex items-center border-b p-4 justify-between",children:[(0,a.jsx)("h1",{className:"text-sm font-bold text-gray-800",children:"Added questions"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.$n,{onClick:()=>{let e=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),l=document.createElement("a");l.href=s,l.download="regression.json",document.body.appendChild(l),l.click(),document.body.removeChild(l)},children:"Download JSON"}),(0,a.jsxs)(m.$n,{variant:"primary",disabled:!v.length||!!S,onClick:()=>T(null),children:["all"===S&&(0,a.jsx)(m.c5,{classNames:"text-white w-4 h-4 mr-2 inline"}),"Validate All"]})]})]}),!v.length&&(0,a.jsx)("div",{className:"p-4 text-gray-500",children:"Please add questions above or upload a JSON file."}),v.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"px-4 my-4",children:(0,a.jsx)(m.pd,{placeholder:"Filter questions",value:w,onChange:e=>q(e.target.value),size:"small",inputClassNames:"rounded-md border-gray-300 w-40 p-1 px-2"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 relative even:bg-gray-100 text-sm font-bold border-b",children:[(0,a.jsx)("div",{className:"col-span-2 p-4 border-r",children:"Question"}),(0,a.jsx)("div",{className:"col-span-4 p-4 border-r",children:"Provided SQL"}),(0,a.jsx)("div",{className:"col-span-4 p-4 border-r",children:"Model SQL"}),(0,a.jsx)("div",{className:"col-span-2 p-4",children:"Result"})]}),v.filter(e=>e.questions.some(e=>e.toLowerCase().includes(w.toLowerCase()))).map(e=>{var s;let l=e.questions.slice(0,-1),r=e.questions.slice(-1);return(0,a.jsxs)("div",{className:"grid grid-cols-12 relative even:bg-gray-100",children:[(0,a.jsxs)("div",{className:"col-span-2 flex flex-col px-6 py-4 border-r",children:[l.length>0&&(0,a.jsx)("div",{className:"absolute z-[2] top-0 -left-2 w-1 h-full border border-r-0 border-gray-300"}),l.map((e,s)=>(0,a.jsx)("div",{className:"relative group text-sm mb-1",children:e},s)),r.map((e,s)=>(0,a.jsx)("div",{className:"relative group text-lg font-semibold mb-4 mt-2",children:e},s))]}),(0,a.jsx)("div",{className:"col-span-4 border-r p-4",children:(0,a.jsx)(d.Ay,{className:"border border-gray-300",extensions:[(0,c.ll)(),d.Lz.lineWrapping],value:e.sql,basicSetup:{lineNumbers:!1},editable:!1})}),(0,a.jsx)("div",{className:"col-span-4 border-r p-4",children:(null===(s=e.validationResult)||void 0===s?void 0:s.model_sql)?(0,a.jsx)(d.Ay,{className:"border border-gray-300",extensions:[(0,c.ll)(),d.Lz.lineWrapping],value:e.validationResult.model_sql,basicSetup:{lineNumbers:!1},editable:!1}):null}),(0,a.jsxs)("div",{className:"col-span-2 p-4",children:[S!==e.id&&e.validationResult&&(e.validationResult.correct?(0,a.jsxs)("div",{className:"text-green-600 font-semibold mb-2",children:[(0,a.jsx)(n.A,{className:"mr-2"}),"Correct!"]}):(0,a.jsxs)("div",{className:"text-red-600 font-semibold mb-2",children:[(0,a.jsx)(o.A,{className:"mr-2"}),"Incorrect!"]})),(0,a.jsxs)(m.$n,{variant:"secondary",onClick:()=>T(e),disabled:!!S&&S!==e.id,className:"mt-2",children:[S===e.id&&(0,a.jsx)(m.c5,{classNames:"inline w-4 h-4 mr-2 text-blue-600"}),e.validationResult?"Re-validate":"Validate"]})]})]},e.id)})]})]})]})]})]})]})}},4379:(e,s,l)=>{"use strict";l.d(s,{A:()=>r});var a=l(3184);let r=(e,s)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==s?"ws"===e?"".concat((a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(s):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(s):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var s=s=>e(e.s=s);e.O(0,[701,328,766,636,593,792],()=>s(7081)),_N_E=e.O()}]);